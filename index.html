<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Tycoon Bot</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: linear-gradient(145deg, #4776E6 0%, #8E54E9 100%);
      color: white;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Header */
    header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .balance {
      background: rgba(255,255,255,0.2);
      padding: 8px 15px;
      border-radius: 25px;
      font-weight: 600;
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* Profile Card */
    .profile-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      margin: 20px;
      padding: 25px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .profile-row {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .profile-pic {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid gold;
      overflow: hidden;
    }

    .profile-pic img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-name h3 {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .profile-name p {
      opacity: 0.9;
      font-size: 14px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 15px;
    }

    .stat-box {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 15px;
      text-align: center;
    }

    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: gold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.8;
    }

    /* Cards */
    .card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      margin: 20px;
      padding: 20px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    /* Progress Bar */
    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    /* Task Visual */
    .task-visual {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 5px;
      margin: 20px 0;
    }

    .task-dot {
      aspect-ratio: 1;
      border-radius: 4px;
      background: rgba(255,255,255,0.2);
      transition: 0.3s;
    }

    .task-dot.completed {
      background: #4CAF50;
      box-shadow: 0 0 10px #4CAF50;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: 0.3s;
      margin: 10px 0;
    }

    .btn-primary {
      background: linear-gradient(145deg, #4CAF50, #45a049);
    }

    .btn-warning {
      background: linear-gradient(145deg, #FF9800, #F57C00);
    }

    .btn-secondary {
      background: linear-gradient(145deg, #2196F3, #1976D2);
    }

    .btn:active {
      transform: scale(0.98);
    }

    /* Referral Section */
    .referral-box {
      background: rgba(76, 175, 80, 0.2);
      padding: 15px;
      border-radius: 12px;
      border: 2px solid #4CAF50;
      margin: 15px 0;
    }

    .referral-link {
      background: rgba(0,0,0,0.3);
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      word-break: break-all;
      margin: 10px 0;
      font-family: monospace;
    }

    /* History */
    .history-item {
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 10px;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: bold;
    }

    .badge-success {
      background: #4CAF50;
    }

    .badge-warning {
      background: #FF9800;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .nav-item {
      text-align: center;
      flex: 1;
      cursor: pointer;
      opacity: 0.6;
      transition: 0.3s;
    }

    .nav-item.active {
      opacity: 1;
      color: gold;
    }

    .nav-item i {
      font-size: 20px;
      display: block;
      margin-bottom: 4px;
    }

    .nav-item span {
      font-size: 11px;
    }

    /* Sections */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 1000;
      transform: translateX(150%);
      transition: 0.3s;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.error {
      background: #f44336;
    }

    .notification.warning {
      background: #FF9800;
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
    }

    input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    select option {
      background: #333;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: rgba(0,0,0,0.1);
      border-radius: 8px;
      margin: 8px 0;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- Notification -->
<div id="notification" class="notification">
  <span id="notifMsg"></span>
</div>

<!-- Header -->
<header>
  <div class="logo">
    <i class="fas fa-rocket" style="color: gold;"></i>
    Task Tycoon
  </div>
  <div class="balance" id="headerBalance">
    $0.00
  </div>
</header>

<!-- MAIN CONTENT -->

<!-- HOME SECTION -->
<div id="homeSection" class="section active">
  <!-- Profile Card -->
  <div class="profile-card">
    <div class="profile-row">
      <div class="profile-pic">
        <img id="profileImage" src="https://via.placeholder.com/80" alt="Profile">
      </div>
      <div class="profile-name">
        <h3 id="userName">Loading...</h3>
        <p>ID: <span id="userId">------</span></p>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-number" id="todayEarn">$0.00</div>
        <div class="stat-label">Today</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="totalEarn">$0.00</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="totalTasks">0</div>
        <div class="stat-label">Tasks</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="totalReferrals">0</div>
        <div class="stat-label">Referrals</div>
      </div>
    </div>
  </div>

  <!-- Tasks Card -->
  <div class="card">
    <div class="card-title">
      <i class="fas fa-tasks" style="color: gold;"></i>
      <span>Daily Tasks</span>
    </div>
    
    <div class="progress-info">
      <span>Progress</span>
      <span id="taskProgressText">0/100</span>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="taskProgressBar" style="width: 0%"></div>
    </div>
    
    <div class="task-visual" id="taskVisual"></div>
    
    <button class="btn btn-primary" onclick="startTask()">
      <i class="fas fa-play"></i> Start Task ($0.025)
    </button>
  </div>

  <!-- Daily Bonus Card -->
  <div class="card">
    <div class="card-title">
      <i class="fas fa-gift" style="color: gold;"></i>
      <span>Daily Bonus</span>
    </div>
    
    <button class="btn btn-warning" onclick="claimBonus()">
      <i class="fas fa-gift"></i> Claim $0.10
    </button>
  </div>
</div>

<!-- EARN SECTION -->
<div id="earnSection" class="section">
  <div class="card">
    <div class="card-title">
      <i class="fas fa-coins" style="color: gold;"></i>
      <span>Earn Money</span>
    </div>
    
    <div class="progress-info">
      <span>Completed</span>
      <span id="earnProgressText">0/100</span>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="earnProgressBar" style="width: 0%"></div>
    </div>
    
    <div class="task-visual" id="earnTaskVisual"></div>
    
    <div class="info-row">
      <span>Per Task</span>
      <span style="color: gold;">$0.025</span>
    </div>
    
    <div class="info-row">
      <span>Bonus (100 tasks)</span>
      <span style="color: gold;">$1.00</span>
    </div>
    
    <button class="btn btn-primary" onclick="startTask()">
      <i class="fas fa-play"></i> Complete Task
    </button>
  </div>
</div>

<!-- WITHDRAW SECTION -->
<div id="withdrawSection" class="section">
  <div class="card">
    <div class="card-title">
      <i class="fas fa-money-bill-wave" style="color: gold;"></i>
      <span>Withdraw</span>
    </div>
    
    <div class="info-row">
      <span>Available</span>
      <span id="availableBalance" style="color: gold;">$0.00</span>
    </div>
    
    <div class="info-row">
      <span>Withdrawn</span>
      <span id="withdrawnTotal">$0.00</span>
    </div>
    
    <div class="info-row">
      <span>Min. Withdrawal</span>
      <span style="color: gold;">$30.00</span>
    </div>
    
    <div class="info-row">
      <span>Referrals Required</span>
      <span id="requiredReferrals">0/10</span>
    </div>
    
    <input type="number" id="withdrawAmount" placeholder="Enter amount ($30 min)" min="30" step="0.01">
    
    <select id="withdrawMethod">
      <option>Select Method</option>
      <option>PayPal</option>
      <option>Bitcoin</option>
      <option>Bank Transfer</option>
    </select>
    
    <input type="text" id="withdrawAddress" placeholder="Payment Address/Email">
    
    <button class="btn btn-primary" onclick="withdraw()">
      <i class="fas fa-paper-plane"></i> Submit
    </button>
  </div>
</div>

<!-- PROFILE SECTION -->
<div id="profileSection" class="section">
  <div class="card">
    <div class="card-title">
      <i class="fas fa-user" style="color: gold;"></i>
      <span>Profile</span>
    </div>
    
    <div class="profile-row">
      <div class="profile-pic">
        <img id="profilePageImage" src="https://via.placeholder.com/80">
      </div>
      <div class="profile-name">
        <h3 id="profilePageName"></h3>
        <p>@<span id="profileUsername"></span></p>
      </div>
    </div>
    
    <div class="info-row">
      <span>User ID</span>
      <span id="profilePageId"></span>
    </div>
    
    <div class="info-row">
      <span>Joined</span>
      <span id="joinDate"></span>
    </div>
  </div>
  
  <!-- Referral Card -->
  <div class="card">
    <div class="card-title">
      <i class="fas fa-users" style="color: gold;"></i>
      <span>Referral Program</span>
    </div>
    
    <div class="referral-box">
      <div style="text-align: center; margin-bottom: 10px;">
        <strong>Earn $1.00 per referral!</strong>
      </div>
      
      <div class="referral-link" id="referralLink">Loading...</div>
      
      <button class="btn btn-secondary" onclick="copyLink()">
        <i class="fas fa-copy"></i> Copy Link
      </button>
      
      <button class="btn btn-warning" onclick="shareLink()">
        <i class="fas fa-share"></i> Share
      </button>
    </div>
    
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-number" id="profileReferrals">0</div>
        <div class="stat-label">Referrals</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="referralEarnings">$0.00</div>
        <div class="stat-label">Earned</div>
      </div>
    </div>
    
    <div style="margin-top: 20px;">
      <h4 style="margin-bottom: 10px;">
        <i class="fas fa-history"></i> Referral History
      </h4>
      <div id="referralHistory"></div>
    </div>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="switchSection('home')">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </div>
  <div class="nav-item" onclick="switchSection('earn')">
    <i class="fas fa-coins"></i>
    <span>Earn</span>
  </div>
  <div class="nav-item" onclick="switchSection('withdraw')">
    <i class="fas fa-wallet"></i>
    <span>Withdraw</span>
  </div>
  <div class="nav-item" onclick="switchSection('profile')">
    <i class="fas fa-user"></i>
    <span>Profile</span>
  </div>
</div>

<script>
    // ===========================================
    // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
    // ===========================================
    const BOT_USERNAME = "Babu24Bot";  // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®
    
    // ===========================================
    // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
    // ===========================================
    let currentUser = null;
    let taskData = {
        completed: 0,
        remaining: 100,
        todayEarned: 0
    };
    
    let tg = window.Telegram?.WebApp;
    if (tg) {
        tg.ready();
        tg.expand();
        console.log("Telegram WebApp Ready");
    }

    // ===========================================
    // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá
    // ===========================================
    window.addEventListener('DOMContentLoaded', function() {
        initUser();
        updateDisplay();
        createTaskDots();
    });

    // ===========================================
    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
    // ===========================================
    function initUser() {
        let user = null;
        let referrerId = null;
        
        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
        if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
            user = tg.initDataUnsafe.user;
            
            // start_param ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡¶ø‡¶®
            if (tg.initDataUnsafe.start_param) {
                let startParam = tg.initDataUnsafe.start_param;
                console.log("Start param:", startParam);
                
                if (startParam.startsWith('ref_')) {
                    referrerId = startParam.replace('ref_', '');
                    console.log("Referrer found:", referrerId);
                }
            }
        } else {
            // ‡¶°‡ßá‡¶Æ‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞
            user = {
                id: Math.floor(Math.random() * 1000000),
                first_name: "Demo",
                last_name: "User",
                username: "demo_user",
                photo_url: "https://via.placeholder.com/80"
            };
        }
        
        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡¶æ ‡¶§‡ßà‡¶∞‡¶ø
        let storageKey = `user_${user.id}`;
        let saved = localStorage.getItem(storageKey);
        
        if (saved) {
            currentUser = JSON.parse(saved);
            console.log("User loaded:", currentUser);
        } else {
            currentUser = {
                id: user.id,
                firstName: user.first_name,
                lastName: user.last_name || '',
                username: user.username || '',
                photo: user.photo_url || 'https://via.placeholder.com/80',
                balance: 0,
                withdrawn: 0,
                tasks: 0,
                referrals: 0,
                referralEarned: 0,
                referralHistory: [],
                joinDate: new Date().toISOString()
            };
            
            // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏
            if (referrerId && referrerId != user.id) {
                console.log("Processing referral from:", referrerId);
                processReferral(referrerId, user.id);
            }
            
            localStorage.setItem(storageKey, JSON.stringify(currentUser));
        }
        
        // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶°
        let today = new Date().toDateString();
        let taskKey = `tasks_${user.id}_${today}`;
        let savedTasks = localStorage.getItem(taskKey);
        
        if (savedTasks) {
            taskData = JSON.parse(savedTasks);
        } else {
            taskData = {
                completed: 0,
                remaining: 100,
                todayEarned: 0
            };
            localStorage.setItem(taskKey, JSON.stringify(taskData));
        }
    }

    // ===========================================
    // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏
    // ===========================================
    function processReferral(referrerId, newUserId) {
        let referrerKey = `user_${referrerId}`;
        let referrerData = localStorage.getItem(referrerKey);
        
        if (referrerData) {
            let referrer = JSON.parse(referrerData);
            
            // ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ü‡¶ó‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ
            let already = referrer.referralHistory ? 
                referrer.referralHistory.some(r => r.id == newUserId) : false;
            
            if (!already) {
                referrer.referrals = (referrer.referrals || 0) + 1;
                referrer.balance = (referrer.balance || 0) + 1.00;
                referrer.referralEarned = (referrer.referralEarned || 0) + 1.00;
                
                if (!referrer.referralHistory) referrer.referralHistory = [];
                
                referrer.referralHistory.push({
                    id: newUserId,
                    earned: 0,
                    date: new Date().toISOString()
                });
                
                localStorage.setItem(referrerKey, JSON.stringify(referrer));
                console.log("Referral added for:", referrerId);
                
                // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                if (currentUser && referrerId != currentUser.id) {
                    alert("üéâ You got a new referral! $1.00 added!");
                }
            }
        } else {
            // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®
            let pending = JSON.parse(localStorage.getItem('pending_refs') || '[]');
            pending.push({ referrer: referrerId, user: newUserId });
            localStorage.setItem('pending_refs', JSON.stringify(pending));
        }
    }

    // ===========================================
    // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ö‡ßá‡¶ï
    // ===========================================
    function checkPending() {
        if (!currentUser) return;
        
        let pending = JSON.parse(localStorage.getItem('pending_refs') || '[]');
        let newPending = [];
        let updated = false;
        
        pending.forEach(p => {
            if (p.referrer == currentUser.id) {
                if (!currentUser.referralHistory) currentUser.referralHistory = [];
                
                let exists = currentUser.referralHistory.some(r => r.id == p.user);
                
                if (!exists) {
                    currentUser.referrals++;
                    currentUser.balance += 1.00;
                    currentUser.referralEarned += 1.00;
                    
                    currentUser.referralHistory.push({
                        id: p.user,
                        earned: 0,
                        date: p.date || new Date().toISOString()
                    });
                    
                    updated = true;
                }
            } else {
                newPending.push(p);
            }
        });
        
        if (updated) {
            localStorage.setItem(`user_${currentUser.id}`, JSON.stringify(currentUser));
            localStorage.setItem('pending_refs', JSON.stringify(newPending));
            updateDisplay();
        }
    }

    // ===========================================
    // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶π‡¶≤‡ßá
    // ===========================================
    function updateReferralEarnings(userId, amount) {
        // ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        for (let i = 0; i < localStorage.length; i++) {
            let key = localStorage.key(i);
            if (key.startsWith('user_')) {
                try {
                    let user = JSON.parse(localStorage.getItem(key));
                    
                    if (user.referralHistory) {
                        let updated = false;
                        
                        user.referralHistory.forEach(ref => {
                            if (ref.id == userId) {
                                ref.earned = (ref.earned || 0) + amount;
                                updated = true;
                            }
                        });
                        
                        if (updated) {
                            localStorage.setItem(key, JSON.stringify(user));
                        }
                    }
                } catch(e) {}
            }
        }
    }

    // ===========================================
    // ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    // ===========================================
    function updateDisplay() {
        if (!currentUser) return;
        
        let available = (currentUser.balance - currentUser.withdrawn).toFixed(2);
        
        // Header
        document.getElementById('headerBalance').innerText = '$' + available;
        
        // Home
        document.getElementById('profileImage').src = currentUser.photo;
        document.getElementById('userName').innerText = currentUser.firstName + ' ' + currentUser.lastName;
        document.getElementById('userId').innerText = currentUser.id;
        document.getElementById('todayEarn').innerText = '$' + taskData.todayEarned.toFixed(2);
        document.getElementById('totalEarn').innerText = '$' + currentUser.balance.toFixed(2);
        document.getElementById('totalTasks').innerText = currentUser.tasks || 0;
        document.getElementById('totalReferrals').innerText = currentUser.referrals || 0;
        
        // Tasks
        let percent = (taskData.completed / 100) * 100;
        document.getElementById('taskProgressBar').style.width = percent + '%';
        document.getElementById('taskProgressText').innerText = taskData.completed + '/100';
        document.getElementById('earnProgressBar').style.width = percent + '%';
        document.getElementById('earnProgressText').innerText = taskData.completed + '/100';
        
        // Withdraw
        document.getElementById('availableBalance').innerText = '$' + available;
        document.getElementById('withdrawnTotal').innerText = '$' + currentUser.withdrawn.toFixed(2);
        document.getElementById('requiredReferrals').innerText = (currentUser.referrals || 0) + '/10';
        
        // Profile
        document.getElementById('profilePageImage').src = currentUser.photo;
        document.getElementById('profilePageName').innerText = currentUser.firstName + ' ' + currentUser.lastName;
        document.getElementById('profileUsername').innerText = currentUser.username || 'user' + currentUser.id;
        document.getElementById('profilePageId').innerText = currentUser.id;
        
        let join = new Date(currentUser.joinDate);
        document.getElementById('joinDate').innerText = join.toLocaleDateString();
        
        // Referral
        let link = `https://t.me/${BOT_USERNAME}?start=ref_${currentUser.id}`;
        document.getElementById('referralLink').innerText = link;
        document.getElementById('profileReferrals').innerText = currentUser.referrals || 0;
        document.getElementById('referralEarnings').innerText = '$' + (currentUser.referralEarned || 0).toFixed(2);
        
        // History
        showReferralHistory();
        
        // Task dots
        updateTaskDots();
    }

    // ===========================================
    // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶°‡¶ü ‡¶§‡ßà‡¶∞‡¶ø
    // ===========================================
    function createTaskDots() {
        let home = document.getElementById('taskVisual');
        let earn = document.getElementById('earnTaskVisual');
        
        home.innerHTML = '';
        earn.innerHTML = '';
        
        for (let i = 0; i < 100; i++) {
            let dot = document.createElement('div');
            dot.className = 'task-dot';
            dot.id = 'dot_' + i;
            home.appendChild(dot.cloneNode());
            earn.appendChild(dot.cloneNode());
        }
    }
    
    function updateTaskDots() {
        for (let i = 0; i < taskData.completed; i++) {
            let dot1 = document.getElementById('dot_' + i);
            let dot2 = document.getElementById('earnDot_' + i);
            if (dot1) dot1.classList.add('completed');
            if (dot2) dot2.classList.add('completed');
        }
    }

    // ===========================================
    // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø
    // ===========================================
    function showReferralHistory() {
        let history = document.getElementById('referralHistory');
        
        if (!currentUser.referralHistory || currentUser.referralHistory.length == 0) {
            history.innerHTML = '<div style="text-align:center; opacity:0.5;">No referrals yet</div>';
            return;
        }
        
        history.innerHTML = '';
        
        currentUser.referralHistory.forEach(ref => {
            let item = document.createElement('div');
            item.className = 'history-item';
            
            let percent = (ref.earned / 30) * 100;
            let status = percent >= 100 ? 'Completed' : 'Active';
            let badge = percent >= 100 ? 'badge-success' : 'badge-warning';
            
            item.innerHTML = `
                <div>
                    <div><strong>User #${ref.id}</strong></div>
                    <div style="font-size:12px;">Earned: $${ref.earned.toFixed(2)}</div>
                </div>
                <div class="badge ${badge}">${status}</div>
            `;
            
            history.appendChild(item);
        });
    }

    // ===========================================
    // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü
    // ===========================================
    function startTask() {
        if (taskData.completed >= 100) {
            alert('‚úÖ All tasks completed for today!');
            return;
        }
        
        let start = Date.now();
        let win = window.open('https://www.google.com', '_blank');
        
        if (!win) {
            alert('‚ö†Ô∏è Please allow popups!');
            return;
        }
        
        let check = setInterval(() => {
            if (win.closed) {
                clearInterval(check);
                let time = (Date.now() - start) / 1000;
                
                if (time >= 3) { // ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
                    taskData.completed++;
                    taskData.todayEarned += 0.025;
                    currentUser.balance += 0.025;
                    currentUser.tasks++;
                    
                    // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    updateReferralEarnings(currentUser.id, 0.025);
                    
                    // ‡¶∏‡ßá‡¶≠
                    let today = new Date().toDateString();
                    localStorage.setItem(`tasks_${currentUser.id}_${today}`, JSON.stringify(taskData));
                    localStorage.setItem(`user_${currentUser.id}`, JSON.stringify(currentUser));
                    
                    updateDisplay();
                    alert('‚úÖ +$0.025 earned!');
                    
                    // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï
                    if (taskData.completed == 100) {
                        currentUser.balance += 1.00;
                        localStorage.setItem(`user_${currentUser.id}`, JSON.stringify(currentUser));
                        updateDisplay();
                        alert('üéâ Bonus $1.00 earned!');
                    }
                } else {
                    alert('‚è±Ô∏è Please stay longer!');
                }
            }
        }, 500);
    }

    // ===========================================
    // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ
    // ===========================================
    function claimBonus() {
        let last = localStorage.getItem(`bonus_${currentUser.id}`);
        let today = new Date().toDateString();
        
        if (last == today) {
            alert('‚ö†Ô∏è Already claimed today!');
            return;
        }
        
        currentUser.balance += 0.10;
        taskData.todayEarned += 0.10;
        
        localStorage.setItem(`bonus_${currentUser.id}`, today);
        localStorage.setItem(`user_${currentUser.id}`, JSON.stringify(currentUser));
        
        let taskKey = `tasks_${currentUser.id}_${today}`;
        localStorage.setItem(taskKey, JSON.stringify(taskData));
        
        updateDisplay();
        alert('üéÅ +$0.10 bonus claimed!');
    }

    // ===========================================
    // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞
    // ===========================================
    function withdraw() {
        let amount = parseFloat(document.getElementById('withdrawAmount').value);
        let method = document.getElementById('withdrawMethod').value;
        let address = document.getElementById('withdrawAddress').value;
        
        let available = currentUser.balance - currentUser.withdrawn;
        
        if (!amount || amount < 30) {
            alert('Minimum $30 required!');
            return;
        }
        
        if (amount > available) {
            alert('Insufficient balance!');
            return;
        }
        
        if ((currentUser.referrals || 0) < 10) {
            alert('Need 10 referrals to withdraw!');
            return;
        }
        
        if (method == 'Select Method') {
            alert('Select payment method!');
            return;
        }
        
        if (!address) {
            alert('Enter payment address!');
            return;
        }
        
        currentUser.withdrawn += amount;
        localStorage.setItem(`user_${currentUser.id}`, JSON.stringify(currentUser));
        
        updateDisplay();
        alert('‚úÖ Withdrawal request submitted!');
        
        // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
        document.getElementById('withdrawAmount').value = '';
        document.getElementById('withdrawMethod').value = 'Select Method';
        document.getElementById('withdrawAddress').value = '';
    }

    // ===========================================
    // ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø
    // ===========================================
    function copyLink() {
        let link = `https://t.me/${BOT_USERNAME}?start=ref_${currentUser.id}`;
        navigator.clipboard.writeText(link).then(() => {
            alert('‚úÖ Link copied!');
        });
    }
    
    function shareLink() {
        let link = `https://t.me/${BOT_USERNAME}?start=ref_${currentUser.id}`;
        
        if (tg) {
            tg.openTelegramLink(link);
        } else {
            copyLink();
        }
    }

    // ===========================================
    // ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡ßÅ‡¶á‡¶ö
    // ===========================================
    function switchSection(section) {
        // ‡¶∏‡¶¨ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶π‡¶æ‡¶á‡¶°
        document.getElementById('homeSection').classList.remove('active');
        document.getElementById('earnSection').classList.remove('active');
        document.getElementById('withdrawSection').classList.remove('active');
        document.getElementById('profileSection').classList.remove('active');
        
        // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        document.getElementById(section + 'Section').classList.add('active');
        
        // ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        
        // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ö‡ßá‡¶ï
        if (section == 'profile') {
            checkPending();
        }
    }

    // ===========================================
    // ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶ü‡ßÅ‡¶≤‡¶∏
    // ===========================================
    window.debug = {
        status: function() {
            console.log('Current User:', currentUser);
            console.log('Task Data:', taskData);
            console.log('Bot:', BOT_USERNAME);
            
            let pending = JSON.parse(localStorage.getItem('pending_refs') || '[]');
            console.log('Pending:', pending);
        },
        addReferral: function(id) {
            processReferral(id, currentUser.id);
            alert('Test referral added from ' + id);
        }
    };
    
    console.log('‚úÖ System Ready! Type "debug.status()" to check');
</script>
</body>
</html>
